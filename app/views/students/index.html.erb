<div class="container students">
  <h1>Listing students</h1>

  <table>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Account Name</th>
      <th>Group</th>
      <% @iterations.each do |iteration| %>
        <th>
          <div class="received-evaluations-heading">Evaluations Received From <%= iteration.name %></div>
          <%= link_to "Email All Evaluations", "#", :class => "btn email-evaluations-btn", :"data-iteration-id" => iteration.id, :"data-iteration-name" => iteration.name %>
        </th>
      <% end %>
      <th></th>
      <th></th>
      <th></th>
    </tr>

  <% @students.each do |student| %>
    <tr class="<%= student.group_id % 2 == 1 ? "odd" : "even" %>">
      <td><%= student.id %></td>
      <td><%= student.full_name %></td>
      <td><%= student.nick_name %></td>
      <td><%= link_to student.group_id, group_path(student.group_id) %></td>

      <% @iterations.each do |iteration| %>
      <td class="received-evaluations">
        <%= show_received_evaluations(@evaluations_for_gradee_hash, @students_for_group_hash, student, iteration) %>
      </td>
      <% end %>

      <td><%= link_to 'Show', student %></td>
      <td><%= link_to 'Edit', edit_student_path(student) %></td>
      <td><%= link_to 'Destroy', student, confirm: 'Are you sure?', method: :delete %></td>
    </tr>
  <% end %>
  </table>

  <br />

  <%= link_to 'New Student', new_student_path %>
</div>

<script type="text/javascript">
  $().ready(function() {
    $('.email-evaluations-btn').live('click', function(e) {
      var iterationId     = $(this).attr('data-iteration-id'),
          iterationName   = $(this).attr('data-iteration-name'),
          confirmStr      = 'You are about to send all evaluations for ' + iterationName + '. Are you sure?',
          confirmVal      = confirm(confirmStr);

      console.log(confirmVal);
      if (confirmVal) {
        $.ajax({
          url: '<%= admin_email_team_evaluations_path() %>',
          data: { 'iteration_id': iterationId }
        });
      }
      e.preventDefault();
    });
  });

</script>
